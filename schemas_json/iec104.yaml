---
"$schema": "http://json-schema.org/schema#"
id: "hat-gateway://iec104.yaml#"
definitions:
    master:
        type: object
        required:
            - remote_addresses
            - response_timeout
            - supervisory_timeout
            - test_timeout
            - send_window_size
            - receive_window_size
            - reconnect_delay
            - time_sync_delay
            - security
        properties:
            remote_addresses:
                type: array
                items:
                    type: object
                    required:
                        - host
                        - port
                    properties:
                        host:
                            type: string
                        port:
                            type: integer
            response_timeout:
                type: number
            supervisory_timeout:
                type: number
            test_timeout:
                type: number
            send_window_size:
                type: integer
            receive_window_size:
                type: integer
            reconnect_delay:
                type: number
            time_sync_delay:
                type:
                    - "null"
                    - number
            security:
                oneOf:
                  - type: "null"
                  - "$ref": "hat-gateway://iec104.yaml#/definitions/security"
    slave:
        type: object
        required:
            - local_host
            - local_port
            - remote_hosts
            - max_connections
            - response_timeout
            - supervisory_timeout
            - test_timeout
            - send_window_size
            - receive_window_size
            - security
            - buffers
            - data
        properties:
            local_host:
                type: string
            local_port:
                type: integer
            remote_hosts:
                type:
                    - array
                    - "null"
                description: |
                    if null, all remote hosts are allowed
                items:
                    type: string
            max_connections:
                type:
                    - "null"
                    - integer
            response_timeout:
                type: number
            supervisory_timeout:
                type: number
            test_timeout:
                type: number
            send_window_size:
                type: integer
            receive_window_size:
                type: integer
            security:
                oneOf:
                  - type: "null"
                  - "$ref": "hat-gateway://iec104.yaml#/definitions/security"
            buffers:
                type: array
                items:
                    type: object
                    required:
                        - name
                        - size
                    properties:
                        name:
                            type: string
                        size:
                            type: integer
            data:
                type: array
                items:
                    type: object
                    required:
                        - data_type
                        - asdu_address
                        - io_address
                        - buffer
                    properties:
                        data_type:
                            enum:
                                - SINGLE
                                - DOUBLE
                                - STEP_POSITION
                                - BITSTRING
                                - NORMALIZED
                                - SCALED
                                - FLOATING
                                - BINARY_COUNTER
                                - PROTECTION
                                - PROTECTION_START
                                - PROTECTION_COMMAND
                                - STATUS
                        asdu_address:
                            type: integer
                        io_address:
                            type: integer
                        buffer:
                            type:
                                - "null"
                                - string
    events:
        master:
            gateway:
                status:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/status"
                data:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/data/res"
                command:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/command/res"
                interrogation:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/interrogation/res"
                counter_interrogation:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/counter_interrogation/res"
            system:
                command:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/command/req"
                interrogation:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/interrogation/req"
                counter_interrogation:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/counter_interrogation/req"
        slave:
            gateway:
                connections:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/connections"
                command:
                    allOf:
                      - type: object
                        required:
                            - connection_id
                        properties:
                            connection_id:
                                type: integer
                      - "$ref": "hat-gateway://iec104.yaml#/definitions/messages/command/req"
            system:
                data:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/messages/data/res"
                command:
                    allOf:
                      - type: object
                        required:
                            - connection_id
                        properties:
                            connection_id:
                                type: integer
                      - "$ref": "hat-gateway://iec104.yaml#/definitions/messages/command/res"
    messages:
        status:
            enum:
                - CONNECTING
                - CONNECTED
                - DISCONNECTED
        connections:
            type: array
            items:
                type: object
                required:
                    - connection_id
                    - local
                    - remote
                properties:
                    connection_id:
                        type: integer
                    local:
                        type: object
                        required:
                            - host
                            - port
                        properties:
                            host:
                                type: string
                            port:
                                type: integer
                    remote:
                        type: object
                        required:
                            - host
                            - port
                        properties:
                            host:
                                type: string
                            port:
                                type: integer
        data:
            res:
                type: object
                required:
                    - is_test
                    - cause
                    - data
                properties:
                    is_test:
                        type: boolean
                    cause:
                        "$ref": "hat-gateway://iec104.yaml#/definitions/causes/data/res"
                    data:
                        oneOf:
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/single"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/double"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/step_position"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/bitstring"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/normalized"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/scaled"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/floating"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/binary_counter"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/protection"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/protection_start"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/protection_command"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/data/status"
        command:
            req:
                type: object
                required:
                    - is_test
                    - cause
                    - command
                properties:
                    is_test:
                        type: boolean
                    cause:
                        "$ref": "hat-gateway://iec104.yaml#/definitions/causes/command/req"
                    command:
                        oneOf:
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/single"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/double"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/regulating"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/normalized"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/scaled"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/floating"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/bitstring"
            res:
                type: object
                required:
                    - is_test
                    - is_negative_confirm
                    - cause
                    - command
                properties:
                    is_test:
                        type: boolean
                    is_negative_confirm:
                        type: boolean
                    cause:
                        "$ref": "hat-gateway://iec104.yaml#/definitions/causes/command/res"
                    command:
                        oneOf:
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/single"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/double"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/regulating"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/normalized"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/scaled"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/floating"
                            - "$ref": "hat-gateway://iec104.yaml#/definitions/commands/bitstring"
        interrogation:
            req:
                type: object
                required:
                    - is_test
                    - request
                    - cause
                properties:
                    is_test:
                        type: boolean
                    request:
                        type: integer
                        description: |
                            request in range [0, 255]
                    cause:
                        "$ref": "hat-gateway://iec104.yaml#/definitions/causes/command/req"
            res:
                type: object
                required:
                    - is_test
                    - is_negative_confirm
                    - request
                    - cause
                properties:
                    is_test:
                        type: boolean
                    is_negative_confirm:
                        type: boolean
                    request:
                        type: integer
                        description: |
                            request in range [0, 255]
                    cause:
                        "$ref": "hat-gateway://iec104.yaml#/definitions/causes/command/res"
        counter_interrogation:
            req:
                allOf:
                  - type: object
                    required:
                        - freeze
                    properties:
                        freeze:
                            enum:
                                - READ
                                - FREEZE
                                - FREEZE_AND_RESET
                                - RESET
                  - "$ref": "hat-gateway://iec104.yaml#/definitions/messages/interrogation/req"
            res:
                allOf:
                  - type: object
                    required:
                        - freeze
                    properties:
                        freeze:
                            enum:
                                - READ
                                - FREEZE
                                - FREEZE_AND_RESET
                                - RESET
                  - "$ref": "hat-gateway://iec104.yaml#/definitions/messages/interrogation/res"
    data:
        single:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/single"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/indication"
        double:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/double"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/indication"
        step_position:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/step_position"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
        bitstring:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/bitstring"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
        normalized:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/normalized"
                quality:
                    oneOf:
                      - type: "null"
                      - "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
        scaled:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/scaled"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
        floating:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/floating"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
        binary_counter:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/binary_counter"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/counter"
        protection:
            type: object
            required:
                - value
                - quality
                - elapsed_time
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/protection"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/protection"
                elapsed_time:
                    type: integer
                    description: |
                        elapsed_time in range [0, 65535]
        protection_start:
            type: object
            required:
                - value
                - quality
                - duration_time
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/protection_start"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/protection"
                duration_time:
                    type: integer
                    description: |
                        duration_time in range [0, 65535]
        protection_command:
            type: object
            required:
                - value
                - quality
                - operating_time
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/protection_command"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/protection"
                operating_time:
                    type: integer
                    description: |
                        operating_time in range [0, 65535]
        status:
            type: object
            required:
                - value
                - quality
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/status"
                quality:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/qualities/measurement"
    commands:
        single:
            type: object
            required:
                - value
                - select
                - qualifier
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/single"
                select:
                    type: boolean
                qualifier:
                    type: integer
                    description: |
                        qualifier in range [0, 31]
        double:
            type: object
            required:
                - value
                - select
                - qualifier
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/double"
                select:
                    type: boolean
                qualifier:
                    type: integer
                    description: |
                        qualifier in range [0, 31]
        regulating:
            type: object
            required:
                - value
                - select
                - qualifier
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/regulating"
                select:
                    type: boolean
                qualifier:
                    type: integer
                    description: |
                        qualifier in range [0, 31]
        normalized:
            type: object
            required:
                - value
                - select
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/normalized"
                select:
                    type: boolean
        scaled:
            type: object
            required:
                - value
                - select
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/scaled"
                select:
                    type: boolean
        floating:
            type: object
            required:
                - value
                - select
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/floating"
                select:
                    type: boolean
        bitstring:
            type: object
            required:
                - value
            properties:
                value:
                    "$ref": "hat-gateway://iec104.yaml#/definitions/values/bitstring"
    values:
        single:
            enum:
                - "OFF"
                - "ON"
        double:
            enum:
                - "INTERMEDIATE"
                - "OFF"
                - "ON"
                - "FAULT"
        regulating:
            enum:
                - LOWER
                - HIGHER
        step_position:
            type: object
            required:
                - value
                - transient
            properties:
                value:
                    type: integer
                    description: |
                        value in range [-64, 63]
                transient:
                    type: boolean
        bitstring:
            type: array
            description: |
                bitstring encoded as 4 bytes
            items:
                type: integer
        normalized:
            type: number
            description: |
                value in range [-1.0, 1.0)
        scaled:
            type: integer
            description: |
                value in range [-2^15, 2^15-1]
        floating:
            type: number
        binary_counter:
            type: integer
            description: |
                value in range [-2^31, 2^31-1]
        protection:
            enum:
                - "OFF"
                - "ON"
        protection_start:
            type: object
            required:
                - general
                - l1
                - l2
                - l3
                - ie
                - reverse
            properties:
                general:
                    type: boolean
                l1:
                    type: boolean
                l2:
                    type: boolean
                l3:
                    type: boolean
                ie:
                    type: boolean
                reverse:
                    type: boolean
        protection_command:
            type: object
            required:
                - general
                - l1
                - l2
                - l3
            properties:
                general:
                    type: boolean
                l1:
                    type: boolean
                l2:
                    type: boolean
                l3:
                    type: boolean
        status:
            type: object
            required:
                - value
                - change
            properties:
                value:
                    type: array
                    description: |
                        value length is 16
                    items:
                        type: boolean
                change:
                    type: array
                    description: |
                        change length is 16
                    items:
                        type: boolean
    qualities:
        indication:
            type: object
            required:
                - invalid
                - not_topical
                - substituted
                - blocked
            properties:
                invalid:
                    type: boolean
                not_topical:
                    type: boolean
                substituted:
                    type: boolean
                blocked:
                    type: boolean
        measurement:
            type: object
            required:
                - invalid
                - not_topical
                - substituted
                - blocked
                - overflow
            properties:
                invalid:
                    type: boolean
                not_topical:
                    type: boolean
                substituted:
                    type: boolean
                blocked:
                    type: boolean
                overflow:
                    type: boolean
        counter:
            type: object
            required:
                - invalid
                - adjusted
                - overflow
                - sequence
            properties:
                invalid:
                    type: boolean
                adjusted:
                    type: boolean
                overflow:
                    type: boolean
                sequence:
                    type: boolean
        protection:
            type: object
            required:
                - invalid
                - not_topical
                - substituted
                - blocked
                - time_invalid
            properties:
                invalid:
                    type: boolean
                not_topical:
                    type: boolean
                substituted:
                    type: boolean
                blocked:
                    type: boolean
                time_invalid:
                    type: boolean
    causes:
        data:
            res:
                oneOf:
                  - enum:
                        - PERIODIC
                        - BACKGROUND_SCAN
                        - SPONTANEOUS
                        - REQUEST
                        - REMOTE_COMMAND
                        - LOCAL_COMMAND
                        - INTERROGATED
                  - type: integer
                    description: |
                        other cause in range [0, 63]
        command:
            req:
                oneOf:
                  - enum:
                        - ACTIVATION
                        - DEACTIVATION
                  - type: integer
                    description: |
                        other cause in range [0, 63]
            res:
                oneOf:
                  - enum:
                        - ACTIVATION_CONFIRMATION
                        - DEACTIVATION_CONFIRMATION
                        - ACTIVATION_TERMINATION
                        - UNKNOWN_TYPE
                        - UNKNOWN_CAUSE
                        - UNKNOWN_ASDU_ADDRESS
                        - UNKNOWN_IO_ADDRESS
                  - type: integer
                    description: |
                        other cause in range [0, 63]
    security:
        type: object
        required:
            - cert_path
            - key_path
            - verify_cert
            - ca_path
        properties:
            cert_path:
                type: string
            key_path:
                type:
                    - "null"
                    - string
            verify_cert:
                type: boolean
            ca_path:
                type:
                    - "null"
                    - string
            strict_mode:
                type: boolean
            renegotiate_delay:
                type:
                    - "null"
                    - number
...
